import os

cmd = "make"
cmd += " KOKKOS_PATH=../../../kokkos/"
cmd += " KOKKOS_DEVICES=Cuda"
cmd += " VERBOSE=1"

print("********** ALL HIER ************")
retval = os.system(cmd)
print(retval)
print("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")

link_cmd = "cd ../../../build;"

link_cmd += " ../modules/kokkos//bin/nvcc_wrapper -o lib/libsimtbx_kokkos.so -shared"
link_cmd += " simtbx/kokkos/kokkos_utils.o simtbx/kokkos/kokkos_instance.o simtbx/kokkos/detector.o simtbx/kokkos/structure_factors.o simtbx/kokkos/simulation.o"
link_cmd += " -Llib -L/usr/common/software/sles15_cgpu/cuda/11.1.1/lib64 -L/global/cfs/cdirs/nstaff/wittwer/alcc-recipes/cctbx/modules/lib -L/global/cfs/cdirs/nstaff/wittwer/alcc-recipes/cctbx/modules/cctbx_project/lib -L/global/cfs/cdirs/nstaff/wittwer/alcc-recipes/cctbx/modules/cctbx_project/simtbx/kokkos/"
link_cmd += " -lkokkos -ldl -lcudart -lcuda -lboost_thread -lboost_system -lboost_python -lm;"

link_cmd += "g++ -o lib/simtbx_kokkos_ext.so -shared -s -std=c++11 -fopenmp simtbx/kokkos/kokkos_ext.o"
link_cmd += " -Llib -L/global/cfs/cdirs/nstaff/wittwer/alcc-recipes/cctbx/modules/lib -L/global/cfs/cdirs/nstaff/wittwer/alcc-recipes/cctbx/modules/cctbx_project/lib -L/global/cfs/cdirs/nstaff/wittwer/alcc-recipes/cctbx/modules/cctbx_project/simtbx/kokkos/ -L/usr/common/software/sles15_cgpu/cuda/11.1.1/lib64"
link_cmd += " -lsimtbx_kokkos -lomptbx -lboost_thread -lboost_system -lboost_python -lm -lm -lscitbx_boost_python -lboost_python -lcctbx -lkokkos -ldl -lcudart -lcuda"

os.system(link_cmd)

#Import("env", "env_etc")

#simtbx_kokkos_env = env.Clone()
#simtbx_kokkos_obj = simtbx_kokkos_env.SharedObject(
#  target="#simtbx/kokkos/kokkos_ext.o",
#  source=["kokkos_ext.cpp",]
#)

#import libtbx.load_env

#Import("env_boost_python_ext")
#env_bpl = env_boost_python_ext.Clone()

#env_bpl.Prepend()

